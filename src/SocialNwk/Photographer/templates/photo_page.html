{% extends "base.html" %}
{% load staticfiles %}
{% block title %}DETAIL{% endblock %}
{% block head_script %}
    <!--<link href="{% static 'tuolei.css' %}" rel="stylesheet" type="text/css">-->
{% endblock %}
{% block content %}
    <div id="head">
        <h3 id="photo_title"></h3>
        <h4 id="photo_author"><a></a></h4>
        {% if not me %}
        <button id="unfollow">Unfollow</button>
        <button id="follow">Follow</button>
        {% endif %}
    </div>
    <div id='features'><h3>Categories</h3>
    </div>
    <div id="stat">
        <h3>Photo Details</h3>
    </div>

    </div>
    <div id="bigPhoto">
        <img src="" />
    </div>

    <div id="comment"></div>
{% endblock %}

{% block foot_script %}
<script src="{% static 'tuolei.js' %}"></script>
<script>
    photo_detail_url = "{% url 'photo:photo-detail' pk %}"
    user_url = "{% url 'photo:user_page' 1 %}"
    user_url = user_url.substring(0, user_url.length - 2)
    $(document).ready(function(){
        loadPhotoDetail();
        {% if followed %}
            $('#follow').hide()
        {% else %}
            $('#unfollow').hide()
        {% endif %}
        $('#follow').click(function(){
            $.get("{% url 'photo:user-follow' author %}", {
            }, function(data, status, xhr) {
                $('#follow').hide()
                $('#unfollow').show()
            });
        });
        $('#unfollow').click(function(){
            $.get("{% url 'photo:user-unfollow' author %}", {
            }, function(data, status, xhr) {
                $('#follow').show()
                $('#unfollow').hide()
            });
        });
        //for photo detail stat to scroll with page
        $(window).scroll(function(){
            footertotop = ($('.footer').position().top);
            scrolltop = $(document).scrollTop()+450;
            difference = scrolltop-footertotop;
            // if user has scrolled further than footer,
            // pull sidebar up using a negative margin

            if (scrolltop > footertotop) {
                $('#stat').css('margin-top',  0-difference);
            }

            else  {
                $('#stat').css('margin-top', 0);
            }

        });

        //to show li if true
        //$('#portrait').hide();

    })
    function checkPhotoDetail(selector){
        console.log("selector: "+selector);
        console.log("value: " + selector.value);
    };
    function loadPhotoDetail(){
    $.ajax({
        type: "GET",
        url: photo_detail_url,
        dataType: "json"
    }).success(function(data, textStatus, jqXHR){
        $("#photo_title").html(data.title);
        $("#photo_author").find('a').html('By: '+data.authorName).attr('href', user_url + data.author);
        $("#bigPhoto img").attr('src', data.file);
        $.each(data, function(key, value) {
            switch(key){
                case 'portrait':
                case 'landscape':
                case 'telephoto':
                case 'low_light':
                case 'high_speed':
                case 'long_exposure':
                    var key1 = key;
                    var key2 = key;
                    key1 = key1.replace('_', '');
                    key2 = key2.replace('_', ' ');
                    if(value==true){
                        $('#features').append("<li id='features'><img id='categories' src='/static/images/"+key1+"_white.png'><b>&nbsp;&nbsp;"+key2 + "</b></li>");
                    }
                    break;
                default:
                    var key1 = key;
                    key1 = key1.replace('_', ' ');
                    $('#stat').append("<li><b>" + key1 + "</b>: " + value + "</li>");    
                    break;
            }
        });
        $.get
    }).fail(function( jqXHR, textStatus ) {
        alert('Request Failed');
    });
}

</script>
{% endblock %}